cmake_minimum_required(VERSION 3.14)
project(F18system Fortran)
enable_testing()

add_executable(color color_text.f90)
add_test(NAME Color COMMAND color)

add_library(osdet os_detect.f90)

add_executable(gitrev gitrev.f90)
add_test(NAME Git COMMAND gitrev)

add_executable(complog compiler_log.f90)
add_test(NAME Compiler COMMAND complog)

find_package(Python3 COMPONENTS Interpreter)
if(Python3_FOUND)
  execute_process(COMMAND ${Python3_EXECUTABLE} -c "import psutil" RESULT_VARIABLE _ret)
  if(_ret EQUAL 0)
    set(Python_OK true)
  else()
    set(Python_OK false)
  endif()
endif()
if(Python_OK)
  add_executable(callpython call_python_script.f90)
  target_link_libraries(callpython PRIVATE osdet)
  add_test(NAME CallPython COMMAND callpython)
else()
  message(STATUS "SKIP: Python test ${Python3_EXECUTABLE} ${_ret}")
endif()

find_program(FFPLAY NAMES ffplay)
add_executable(playsound play_sound.f90)
if(FFPLAY)
  add_test(NAME PlaySound COMMAND $<TARGET_FILE:playsound> ${CMAKE_CURRENT_SOURCE_DIR}/bell.aac)
endif()